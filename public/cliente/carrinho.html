<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carrinho - Pitombo Lanches</title>
  <style>
    :root{--bg:#f7f7f7;--card:#fff;--text:#222;--muted:#6b7280;--brand:#e11d48;--brand2:#16a34a;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial;background:var(--bg);color:var(--text)}
    header{padding:16px 20px;background:#fff;border-bottom:1px solid #eee;display:flex;gap:12px;align-items:center;justify-content:space-between}
    header h1{margin:0;font-size:18px}
    header a{font-size:14px;color:#2563eb;text-decoration:none}
    main{max-width:960px;margin:24px auto;padding:0 16px}
    .box{background:var(--card);border:1px solid #eee;border-radius:10px;padding:16px}
    .row{display:grid;grid-template-columns:1fr 90px 110px 40px;gap:12px;align-items:center;padding:12px 0;border-bottom:1px dashed #eee}
    .row.head{font-weight:600;border-bottom:1px solid #e5e7eb}
    .row:last-child{border-bottom:none}
    .name{font-weight:600}
    .muted{color:var(--muted);font-size:12px}
    .total{display:flex;justify-content:flex-end;gap:24px;margin-top:16px;font-size:18px}
    .total b{font-size:20px}
    .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:16px;flex-wrap:wrap}
    button{border:none;border-radius:8px;padding:12px 16px;cursor:pointer;font-weight:600}
    .ghost{background:#f3f4f6}
    .danger{background:var(--brand);color:#fff}
    .primary{background:#2563eb;color:#fff}
    .success{background:var(--brand2);color:#fff}
    .empty{padding:32px;text-align:center;color:var(--muted)}
    @media (max-width:640px){
      .row{grid-template-columns:1fr 70px 90px 32px}
      header{flex-direction:column;align-items:flex-start;gap:6px}
    }
  </style>
</head>
<body>
  <header>
    <h1>üß∫ Carrinho</h1>
    <nav>
      <a href="/cliente/index.html">‚¨ÖÔ∏è Voltar ao in√≠cio</a> ‚Ä¢
      <a href="/cliente/cardapio.html">üçî Ver card√°pio</a>
    </nav>
  </header>

  <main>
    <div class="box" id="cartBox">
      <div class="row head">
        <div>Item</div>
        <div>Qtd</div>
        <div>Subtotal</div>
        <div></div>
      </div>
      <div id="cartRows"></div>
      <div class="empty" id="emptyMsg" style="display:none">Seu carrinho est√° vazio.</div>

      <div class="total">
        <span>Total:</span>
        <b id="totalBRL">R$ 0,00</b>
      </div>

      <div class="actions">
        <button class="ghost" onclick="limpar()">Limpar</button>
        <button class="primary" onclick="continuar()">Adicionar mais itens</button>
        <button class="success" onclick="finalizar()">Finalizar pedido</button>
      </div>
    </div>
  </main>

  <script>
    // Aceita duas poss√≠veis chaves para compatibilidade
    const KEY1 = 'carrinho';
    const KEY2 = 'cart';

    const brl = v => (v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    function getCart(){
      try{
        const raw = localStorage.getItem(KEY1) ?? localStorage.getItem(KEY2) ?? '[]';
        const arr = JSON.parse(raw);
        if(Array.isArray(arr)) return arr;
      }catch(e){}
      return [];
    }

    function setCart(items){
      localStorage.setItem(KEY1, JSON.stringify(items));
      // opcionalmente manter a outra chave sincronizada
      localStorage.setItem(KEY2, JSON.stringify(items));
    }

    function render(){
      const rowsEl = document.getElementById('cartRows');
      const emptyEl = document.getElementById('emptyMsg');
      const totalEl = document.getElementById('totalBRL');

      const items = getCart();
      rowsEl.innerHTML = '';
      let total = 0;

      if(items.length === 0){
        emptyEl.style.display = '';
        totalEl.textContent = brl(0);
        return;
      } else {
        emptyEl.style.display = 'none';
      }

      items.forEach((it, idx)=>{
        const qtd = Number(it.qtd || 1);
        const preco = Number(it.preco || it.price || 0); // compat
        const subtotal = qtd * preco;
        total += subtotal;

        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div>
            <div class="name">${it.nome || it.name || 'Item'}</div>
            ${it.obs ? `<div class="muted">${it.obs}</div>`: ''}
          </div>
          <div>
            <button class="ghost" onclick="alterar(${idx},-1)">-</button>
            <span style="margin:0 8px">${qtd}</span>
            <button class="ghost" onclick="alterar(${idx},+1)">+</button>
          </div>
          <div>${brl(subtotal)}</div>
          <div><button class="danger" title="Remover" onclick="remover(${idx})">‚úñ</button></div>
        `;
        rowsEl.appendChild(row);
      });

      totalEl.textContent = brl(total);
    }

    function alterar(i, delta){
      const items = getCart();
      if(!items[i]) return;
      items[i].qtd = Math.max(1, Number(items[i].qtd||1) + delta);
      setCart(items);
      render();
    }

    function remover(i){
      const items = getCart();
      items.splice(i,1);
      setCart(items);
      render();
    }

    function limpar(){
      if(confirm('Limpar o carrinho?')){
        setCart([]);
        render();
      }
    }

    function continuar(){
      window.location.href = '/cliente/cardapio.html';
    }

    function finalizar(){
      const items = getCart();
      if(items.length === 0){
        alert('Seu carrinho est√° vazio.');
        return;
      }
      // aqui futuramente podemos salvar no banco / API
      // por enquanto s√≥ redireciona
      window.location.href = '/pedido-confirmado';
    }

    // Render inicial
    render();
  </script>
</body>
</html>

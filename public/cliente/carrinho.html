<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrinho ‚Ä¢ Pitombo Lanches</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background:#fafafa; color:#222; }
    header { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background:#fff; border-bottom:1px solid #eee; position:sticky; top:0; }
    .title { font-size:20px; font-weight:700; }
    .actions a { margin-left:8px; text-decoration:none; padding:10px 14px; background:#111; color:#fff; border-radius:10px; font-weight:600; }
    .wrap { max-width: 920px; margin: 18px auto; padding: 0 16px; }
    table { width:100%; border-collapse: collapse; background:#fff; border:1px solid #eee; border-radius:12px; overflow:hidden; }
    th, td { padding:12px; border-bottom:1px solid #f0f0f0; text-align:left; }
    tfoot td { font-weight:700; }
    .qty { display:inline-flex; gap:8px; align-items:center; }
    .btn { cursor:pointer; border:0; padding:8px 10px; border-radius:10px; background:#0a7; color:#fff; font-weight:700; }
    .btn.gray { background:#ddd; color:#111; }
    .mt { margin-top:14px; }
  </style>
</head>
<body>
  <header>
    <div class="title">üõí Carrinho</div>
    <div class="actions">
      <a href="/cardapio">Card√°pio</a>
      <a href="/">In√≠cio</a>
    </div>
  </header>

  <div class="wrap">
    <table id="tb">
      <thead>
        <tr><th>Item</th><th>Pre√ßo</th><th>Qtd</th><th>Subtotal</th><th></th></tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr><td colspan="3">Total</td><td id="total">R$ 0,00</td><td></td></tr>
      </tfoot>
    </table>

    <div class="mt" style="display:flex; gap:8px; flex-wrap:wrap;">
      <button class="btn gray" onclick="limpar()">Limpar carrinho</button>
      <button class="btn" onclick="finalizar()">Finalizar pelo WhatsApp</button>
    </div>
  </div>

  <script>
    const CART_KEY = 'pitombo_cart';
    const getCart = () => JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    const setCart = (c) => localStorage.setItem(CART_KEY, JSON.stringify(c));
    const money = (v) => Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    function render(){
      const tb = document.querySelector('#tb tbody');
      const totalEl = document.querySelector('#total');
      const cart = getCart();
      tb.innerHTML = '';

      let total = 0;
      if(cart.length === 0){
        tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#777">Seu carrinho est√° vazio.</td></tr>';
      } else {
        cart.forEach((i,idx)=>{
          const sub = Number(i.preco)*Number(i.qtd);
          total += sub;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${i.nome}</td>
            <td>${money(i.preco)}</td>
            <td>
              <div class="qty">
                <button class="btn gray" onclick="add(${idx},-1)">-</button>
                <strong>${i.qtd}</strong>
                <button class="btn gray" onclick="add(${idx},1)">+</button>
              </div>
            </td>
            <td>${money(sub)}</td>
            <td><button class="btn gray" onclick="rem(${idx})">Remover</button></td>
          `;
          tb.appendChild(tr);
        });
      }
      totalEl.textContent = money(total);
    }

    function add(idx, delta){
      const cart = getCart();
      cart[idx].qtd += delta;
      if (cart[idx].qtd <= 0) cart.splice(idx,1);
      setCart(cart);
      render();
    }

    function rem(idx){
      const cart = getCart();
      cart.splice(idx,1);
      setCart(cart);
      render();
    }

    function limpar(){
      if(confirm('Limpar carrinho?')){
        localStorage.removeItem(CART_KEY);
        render();
      }
    }

    function finalizar(){
      const cart = getCart();
      if(cart.length === 0){
        alert('Adicione itens antes de finalizar.');
        return;
      }

      // monta mensagem
      const linhas = cart.map(i => `‚Ä¢ ${i.qtd}x ${i.nome} ‚Äî ${money(i.preco)} = ${money(i.preco*i.qtd)}`);
      const total = cart.reduce((s,i)=>s + (Number(i.preco)*Number(i.qtd)),0);
      linhas.push(`\nTotal: ${money(total)}`);

      const msg = encodeURIComponent(`Ol√°! Quero fazer um pedido:\n\n${linhas.join('\n')}\n\nNome: `);
const phone = '351934869755'; // n√∫mero com DDI e DDD, sem sinais
const url = `https://wa.me/${phone}?text=${msg}`;

window.open(url, '_blank'); // abre o WhatsApp
window.location.href = '/pedido-confirmado';


      window.open(url, '_blank'); // abre WhatsApp
      window.location.href = '/pedido-confirmado';
    }

    render();
  </script>
</body>
</html>

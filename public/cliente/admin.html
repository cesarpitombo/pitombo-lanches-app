<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Pitombo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto; max-width:920px; margin:24px auto; padding:0 12px;}
    h1{margin:0 0 8px}
    fieldset{border:1px solid #ddd; border-radius:8px; margin:16px 0; padding:12px}
    label{display:block; font-weight:600; margin:8px 0 6px}
    input, textarea{width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:15px}
    button{padding:10px 14px; border:0; border-radius:8px; background:#111; color:#fff; cursor:pointer}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .muted{color:#777; font-size:12px}
    .ok{color:green; font-weight:600}
    .err{color:#b00020; font-weight:600}
  </style>
</head>
<body>
  <h1>Painel Admin</h1>

  <fieldset>
    <label>Token (Bearer)</label>
    <input id="tok" placeholder="Cole aqui seu ADMIN_TOKEN" />
    <div class="muted">Render → Settings → Environment → Key: <b>ADMIN_TOKEN</b></div>
  </fieldset>

  <fieldset>
    <legend><b>Configuração</b></legend>
    <div class="row">
      <div>
        <label>Nome do app</label>
        <input id="appName" placeholder="Pitombo Lanches" />
      </div>
      <div>
        <label>Telefone / WhatsApp (apenas números)</label>
        <input id="phone" placeholder="DDD + número. Ex: 75999999999" />
        <div class="muted">Aceita com ou sem DDI. Se faltar, assumo 55 (Brasil).</div>
      </div>
    </div>
    <div style="margin-top:12px">
      <button id="saveCfg">Salvar Config</button>
      <span id="cfgMsg"></span>
    </div>
  </fieldset>

  <fieldset>
    <legend><b>Menu atual (somente leitura aqui)</b></legend>
    <pre id="menuNow" style="white-space:pre-wrap;background:#f7f7f7;border-radius:8px;padding:12px"></pre>
  </fieldset>

  <script>
    async function load() {
      try {
        const r = await fetch('/api/config', { cache: 'no-store' });
        const cfg = await r.json();
        document.getElementById('appName').value = cfg.appName || '';
        // mostra somente os dígitos
        document.getElementById('phone').value = (cfg.phone || '').replace(/\D+/g,'');
      } catch(e) {}
      try {
        const r2 = await fetch('/api/menu', { cache: 'no-store' });
        const menu = await r2.json();
        document.getElementById('menuNow').textContent = JSON.stringify(menu, null, 2);
      } catch(e) {
        document.getElementById('menuNow').textContent = 'Falha ao carregar menu.';
      }
    }

    async function saveCfg() {
      const tok = document.getElementById('tok').value.trim();
      const appName = document.getElementById('appName').value.trim();
      const phone = document.getElementById('phone').value.trim();

      const msg = document.getElementById('cfgMsg');
      msg.textContent = 'Salvando...'; msg.className = '';

      try {
        const resp = await fetch('/api/config', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + tok
          },
          body: JSON.stringify({ appName, phone })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'erro');
        msg.textContent = 'Salvo com sucesso!'; msg.className = 'ok';
      } catch (e) {
        msg.textContent = 'Erro ao salvar'; msg.className = 'err';
      }
    }

    document.getElementById('saveCfg').addEventListener('click', saveCfg);
    load();
  </script>
</body>
</html>

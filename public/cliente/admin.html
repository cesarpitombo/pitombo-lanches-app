<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>Admin • Pitombo</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 30px auto; }
    input[type="text"], textarea { width: 100%; padding: 10px; margin: 8px 0; }
    button { padding: 10px 16px; cursor: pointer; }
    .row { margin: 16px 0; }
    .hint { color: #666; font-size: 12px; }
    pre { background:#f7f7f7; padding:10px; overflow:auto; }
  </style>
</head>
<body>
  <h1>Painel Admin</h1>

  <div class="row">
    <label>Token (Bearer):</label>
    <input id="tok" type="text" placeholder="Cole aqui seu ADMIN_TOKEN"/>
    <div class="hint">No Render: Settings → Environment → Key <b>ADMIN_TOKEN</b>, Value (ex.: pitombo123) → Save → Redeploy.</div>
  </div>

  <hr/>

  <h2>Configuração</h2>
  <div class="row">
    <label>Nome do app:</label>
    <input id="appName" type="text" placeholder="Ex.: Pitombo Lanches">
    <button onclick="salvarConfig()">Salvar Config</button>
  </div>

  <hr/>

  <h2>Menu (JSON)</h2>
  <div class="hint">Edite o array. Campos por item: id, nome, preco, img.</div>
  <textarea id="menuJson" rows="12"></textarea>
  <div class="row">
    <button onclick="salvarMenu()">Salvar Menu</button>
  </div>

  <h3>Menu atual</h3>
  <pre id="menuAtual">Carregando...</pre>

  <script>
    async function carregar() {
      const cfg = await fetch('/api/config').then(r=>r.json());
      document.getElementById('appName').value = cfg.appName || 'Pitombo Lanches';

      const menu = await fetch('/api/menu').then(r=>r.json());
      document.getElementById('menuJson').value = JSON.stringify(menu, null, 2);
      document.getElementById('menuAtual').textContent = JSON.stringify(menu, null, 2);
    }

    function authHeader() {
      const t = document.getElementById('tok').value.trim();
      return t ? { 'Authorization': 'Bearer ' + t } : {};
    }

    async function salvarConfig() {
      const appName = document.getElementById('appName').value.trim();
      const r = await fetch('/api/config', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', ...authHeader() },
        body: JSON.stringify({ appName })
      });
      alert(r.ok ? 'Config salva!' : 'Falhou salvar config (token?)');
    }

    async function salvarMenu() {
      try {
        const arr = JSON.parse(document.getElementById('menuJson').value);
        const r = await fetch('/api/menu', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', ...authHeader() },
          body: JSON.stringify(arr)
        });
        if (!r.ok) throw 0;
        const novo = await fetch('/api/menu').then(x=>x.json());
        document.getElementById('menuAtual').textContent = JSON.stringify(novo, null, 2);
        alert('Menu salvo!');
      } catch {
        alert('JSON inválido ou token errado.');
      }
    }

    carregar();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Admin - Pitombo Lanches</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial, sans-serif;background:#f6f6f6;margin:0;padding:20px}
    .box{background:#fff;max-width:560px;margin:0 auto;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    h1{margin:0 0 16px;color:#b22222}
    label{display:block;margin:12px 0 6px;color:#333}
    input, textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px}
    button{margin-top:12px;background:#b22222;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button:hover{background:#a01f1f}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    .ok{color:#0a7b2e;margin-top:8px}
    .err{color:#b22222;margin-top:8px}
    hr{margin:20px 0}
    small{color:#666}
  </style>
</head>
<body>
  <div class="box">
    <h1>Painel Administrativo</h1>

    <label>Token de Admin (Bearer)</label>
    <input id="token" placeholder="Digite o token (ex: pitombo1)" />

    <div class="row">
      <div>
        <label>Nome do App</label>
        <input id="appName" placeholder="Pitombo Lanches" />
      </div>
      <div>
        <label>Telefone WhatsApp (DDI+DDD+Número, só dígitos)</label>
        <input id="phone" placeholder="5581999999999" />
        <small>Ex.: Brasil Recife: 55 + 81 + 9XXXXYYYY → <b>55819XXXXYYYY</b></small>
      </div>
    </div>
    <button onclick="salvarConfig()">Salvar Configurações</button>
    <div id="msg"></div>

    <hr />

    <h3>Configuração atual</h3>
    <pre id="cfg" style="white-space:pre-wrap;background:#fafafa;border:1px solid #eee;border-radius:8px;padding:12px"></pre>
  </div>

  <script>
    async function carregar() {
      try {
        const res = await fetch('/api/config');
        const cfg = await res.json();
        document.getElementById('appName').value = cfg.appName || '';
        document.getElementById('phone').value = cfg.phone || '';
        document.getElementById('cfg').textContent = JSON.stringify(cfg, null, 2);
      } catch (e) {
        document.getElementById('cfg').textContent = 'Erro ao carregar config.';
      }
    }

    async function salvarConfig() {
      const token = document.getElementById('token').value.trim();
      const appName = document.getElementById('appName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const msg = document.getElementById('msg');

      msg.textContent = '';

      try {
        const res = await fetch('/api/config', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ appName, phone })
        });
        const data = await res.json();
        if (res.ok && data.ok) {
          msg.className = 'ok';
          msg.textContent = '✔ Configurações salvas!';
          document.getElementById('cfg').textContent = JSON.stringify(data.config, null, 2);
        } else {
          msg.className = 'err';
          msg.textContent = '✖ Erro: ' + (data.error || 'Falha ao salvar');
        }
      } catch (e) {
        msg.className = 'err';
        msg.textContent = '✖ Erro de conexão.';
      }
    }

    carregar();
  </script>
</body>
</html>

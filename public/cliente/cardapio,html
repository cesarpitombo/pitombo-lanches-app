<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Card√°pio - Pitombo Lanches</title>
  <style>
    body { font-family: Arial; background:#fafafa; margin:0; padding:20px; text-align:center; }
    h1 { color:#b22222; }
    .menu { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:20px; }
    .item { background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.1); padding:15px; width:220px; }
    .item img { width:100%; border-radius:8px; }
    .item h3 { margin:10px 0 5px; }
    .item p { margin:0; color:#555; }
    .item button { margin-top:10px; background:#b22222; color:#fff; border:none; border-radius:6px; padding:8px 12px; cursor:pointer; }
    .item button:hover { background:#9e1e1e; }
    .top { margin-bottom: 10px; }
    .top a { display:inline-block; margin:0 6px; padding:8px 12px; background:#444; color:#fff; text-decoration:none; border-radius:6px; }
    .top a:hover { background:#222; }
  </style>
</head>
<body>
  <div class="top">
    <a href="/cliente/index.html">In√≠cio</a>
    <a href="/cliente/carrinho.html">Carrinho üõí</a>
  </div>
  <h1>üçî Card√°pio</h1>
  <div class="menu" id="menu"></div>

  <script>
    const storageKey = 'carrinho';

    function getCarrinho() {
      try { return JSON.parse(localStorage.getItem(storageKey)) || []; }
      catch { return []; }
    }
    function setCarrinho(c) { localStorage.setItem(storageKey, JSON.stringify(c)); }

    async function carregarCardapio() {
      try {
        const resp = await fetch('/cardapio');
        const produtos = await resp.json();
        const el = document.getElementById('menu');
        el.innerHTML = '';
        produtos.forEach(p => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <img src="${p.imagem}" alt="${p.nome}" onerror="this.style.display='none'">
            <h3>${p.nome}</h3>
            <p>R$ ${Number(p.preco).toFixed(2).replace('.', ',')}</p>
            <button>Adicionar</button>
          `;
          div.querySelector('button').onclick = () => {
            const carrinho = getCarrinho();
            const existente = carrinho.find(i => i.id === p.id);
            if (existente) existente.quantidade += 1;
            else carrinho.push({ id: p.id, nome: p.nome, preco: Number(p.preco), quantidade: 1 });
            setCarrinho(carrinho);
            alert(`${p.nome} adicionado!`);
          };
          el.appendChild(div);
        });
      } catch (e) {
        document.getElementById('menu').innerHTML = '<p>Erro ao carregar o card√°pio.</p>';
        console.error(e);
      }
    }
    carregarCardapio();
  </script>
</body>
</html>

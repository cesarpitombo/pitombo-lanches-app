<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel do Admin — Configurações</title>
</head>
<body style="font-family: Arial, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px;">
  <h1>⚙️ Configurações do Aplicativo</h1>

  <p><strong>Dica:</strong> salve o token uma vez e ele fica guardado no navegador.</p>

  <label>Token de Admin (ADMIN_TOKEN)
    <input id="token" type="password" style="width:100%; padding:8px; margin:6px 0;" placeholder="cole aqui o token"/>
  </label>
  <button id="salvarToken">Salvar token</button>
  <button id="limparToken" style="margin-left:8px;">Limpar token</button>

  <hr/>

  <label>Nome do App
    <input id="appName" type="text" style="width:100%; padding:8px; margin:6px 0;" placeholder="ex: Pitombo Lanches"/>
  </label>

  <label>Logo (URL)
    <input id="logoUrl" type="url" style="width:100%; padding:8px; margin:6px 0;" placeholder="https://..."/>
  </label>

  <button id="salvar">Salvar configurações</button>
  <span id="status" style="margin-left:12px;"></span>

  <script>
    // carrega token salvo
    const tokenInput = document.getElementById('token');
    const saved = localStorage.getItem('ADMIN_TOKEN') || '';
    if (saved) tokenInput.value = saved;

    document.getElementById('salvarToken').onclick = () => {
      localStorage.setItem('ADMIN_TOKEN', tokenInput.value.trim());
      alert('Token salvo!');
    };
    document.getElementById('limparToken').onclick = () => {
      localStorage.removeItem('ADMIN_TOKEN');
      tokenInput.value = '';
      alert('Token removido.');
    };

    // carrega config atual
    async function loadConfig() {
      try {
        const res = await fetch('/api/config', { cache: 'no-store' });
        const cfg = await res.json();
        document.getElementById('appName').value = cfg.appName || '';
        document.getElementById('logoUrl').value = cfg.logoUrl || '';
      } catch (e) {
        console.error(e);
        document.getElementById('status').textContent = 'Erro ao carregar config';
      }
    }
    loadConfig();

    // salva config
    document.getElementById('salvar').onclick = async () => {
      const appName = document.getElementById('appName').value.trim();
      const logoUrl = document.getElementById('logoUrl').value.trim();
      const token = (localStorage.getItem('ADMIN_TOKEN') || '').trim();

      document.getElementById('status').textContent = 'Salvando...';

      try {
        const res = await fetch('/api/config', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            ...(token ? { 'Authorization': 'Bearer ' + token } : {})
          },
          body: JSON.stringify({ appName, logoUrl })
        });

        if (!res.ok) {
          const t = await res.text();
          throw new Error(t || ('HTTP ' + res.status));
        }

        document.getElementById('status').textContent = 'Salvo!';
      } catch (e) {
        console.error(e);
        document.getElementById('status').textContent = 'Erro ao salvar (confira o token)';
      }
    };
  </script>
</body>
</html>
